<link rel="import" href="../polymer/polymer.html">
<dom-module id="uke-tab">
  <template>
    <style>
      :host {
        display: inline-block;
      }

      .hidden {
        visibility: hidden;
      }

      #ukeTabSvg {
        font-family: sans-serif;
        font-size: 11px;
      }

      .red {
        color: red;
      }
    </style>
    <svg id="ukeTabSvg" width="72" height="111" xmlns="http://www.w3.org/2000/svg"
         xmlns:xlink="http://www.w3.org/1999/xlink">
      <g id="svg_1" transform="translate(5,12)">
        <rect id="nut" height="4" width="62" fill="black"/>
        <g id="strings" transform="translate(0,2)">
          <rect height="80" width="2" x="0" fill="black"/>
          <rect height="80" width="2" x="20" fill="black"/>
          <rect height="80" width="2" x="40" fill="black"/>
          <rect height="80" width="2" x="60" fill="black"/>
        </g>
        <g id="frets" transform="translate(0,2)">
          <rect height="2" width="62" y="0" fill="black"/>
          <rect height="2" width="62" y="20" fill="black"/>
          <rect height="2" width="62" y="40" fill="black"/>
          <rect height="2" width="62" y="60" fill="black"/>
          <rect height="2" width="62" y="80" fill="black"/>
        </g>
        <g id="closedStrings" transform="translate(1,13)">
          <g id=closedString0>
            <circle cx="0" r="6"/>
            <text fill="white" id="finger0" x="-3" y="4"></text>
          </g>
          <g id="closedString1">
            <circle cx="20" r="6"/>
            <text fill="white" id="finger1" x="17" y="4"></text>
          </g>
          <g id="closedString2">
            <circle cx="40" r="6"/>
            <text fill="white" id="finger2" x="37" y="4"></text>
          </g>
          <g id="closedString3">
            <circle cx="60" r="6"/>
            <text fill="white" id="finger3" x="57" y="4"></text>
          </g>
        </g>
        <g id="openStrings" transform="translate(1,-7)">
          <circle id="openString0" cx="0" r="4" fill="none" stroke="black" stroke-width="1"/>
          <circle id="openString1" cx="20" r="4" fill="none" stroke="black" stroke-width="1"/>
          <circle id="openString2" cx="40" r="4" fill="none" stroke="black" stroke-width="1"/>
          <circle id="openString3" cx="60" r="4" fill="none" stroke="black" stroke-width="1"/>
        </g>

      </g>
    </svg>
  </template>
  <script>
    (function(){
      Polymer({
        is: "uke-tab",
        properties: {
          frets: String,
          fingers: String,
          nut: Boolean
        },
        attached: function(){
          this.parseFrets();
          this.parseFingers();

          if(!this.nut){
            this.toggleClass("hidden", !this.nut, this.$.nut);
          }
        },

        parseFrets: function(){
          var frets;
          if(this.frets){
            frets = this.frets.split("");
            if(frets.length !== 4) return;
            frets.forEach(function(fret, idx){
              this.toggleClass("hidden", fret !== "0", this.$["openString" + idx]);
              this.toggleClass("hidden", fret === "0", this.$["closedString" + idx]);
              this.$["closedString" + idx].setAttribute("transform", "translate(0," + (fret - 1) * 20 + ")");

            }.bind(this));
          }
        },

        parseFingers: function(){
          var fingers;
          if(this.fingers){
            fingers = this.fingers.split("");
            if(fingers.length !== 4) return;
            fingers.forEach(function(finger, idx){
              this.$["finger" + idx].innerHTML = finger !== "0" ? finger : "";
            }.bind(this));
          }
        }
      });
    })();
  </script>
</dom-module>